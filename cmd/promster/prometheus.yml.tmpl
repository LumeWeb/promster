global:
  scrape_interval: {{.ScrapeInterval}}
  scrape_timeout: {{.ScrapeTimeout}}
  evaluation_interval: {{.EvaluationInterval}}

scrape_configs:
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']
    {{ if .AdminPassword }}
    basic_auth:
      username: "{{.AdminUsername}}"
      password: "{{.AdminPassword}}"
    {{ end }}

  {{- if .ServiceGroups }}
  {{- range .ServiceGroups }}
  - job_name: '{{ .Name }}'
    scheme: "{{$.Scheme}}"
    tls_config:
      insecure_skip_verify: {{if eq $.TlsInsecure "true"}}true{{else}}false{{end}}
    static_configs:
      - targets: {{ printf "%#v" .Targets }}
        labels:
          {{- range $key, $value := .Labels }}
          {{ $key }}: "{{ $value }}"
          {{- end }}
    {{ if .BasicAuth }}
    basic_auth:
      username: "{{ .BasicAuth.Username }}"
      password: "{{ .BasicAuth.Password }}"
    {{ end }}
    metrics_path: "{{ .MetricsPath }}"
  {{- end }}
  {{- end }}
